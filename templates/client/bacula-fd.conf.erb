# Bacula File Daemon configuration file
#
# This file is handled by puppet, all modifications will be lost.
#

<%
require 'digest/sha1'

@directors.each do |director|
    if director.keys.include? 'Name'
        server_name = director['Name']
    else
        raise Puppet::Error, 'Required parameter "Name" not present for director'
    end

    if not director.keys.include? 'Password'
        p = [@secret, @name, server_name ].join('')
        director['Password'] = Digest::SHA1.hexdigest p
    end
-%>

Director {
<% director.each do |key, value| -%>
   <%= key %> = "<%= value %>"
<% end -%>
}
<% end -%>

FileDaemon {
  Name                     = <%= scope['::fqdn'] %>-fd
  FDAddress                = {ipv6 = {port = 9102}}
  FDport                   = 9102
  WorkingDirectory         = /var/lib/bacula
  Pid Directory            = /var/run/bacula
  Maximum Concurrent Jobs  = 20
  Heartbeat Interval       = 1 min
}

Messages {
  Name     = Standard
  director = <%= @server %>-dir = all, !skipped, !restored
  syslog   = error, fatal
  append   = "/var/log/bacula/bacula-fd.log" = all, !skipped
}
